# 오늘의집 문의 → AI 답변 → Slack 알림 실행 계획

본 문서는 **API가 없는 외부 커머스 플랫폼(오늘의집)** 환경에서

> "고객 문의 감지 → AI 답변 생성 → 어떤 질문에 어떤 답변이 생성되었는지 Slack으로 공유"

까지 이어지는 **현실적인 실행 중심 MVP 개발 계획**을 정의한다.

---

## 1. 목표 범위 (이번 단계에서 할 것 / 안 할 것)

### ✅ 이번 단계에서 달성할 것

- 고객 문의를 **이메일 기반으로 감지**
- 이메일 원문에서 **실제 고객 질문 텍스트 추출**
- 브랜드 지식(RAG) 기반 **AI 답변 생성**
- 결과를 **Slack으로 요약 전송**
  - 어떤 질문이었는지
  - 어떤 답변이 생성되었는지

### ❌ 이번 단계에서 하지 않을 것

- 오늘의집 서버 크롤링
- 자동 답변 등록 (완전 자동화)
- 정규식 기반 이메일 파싱

---

## 2. 전체 아키텍처 개요

```
[오늘의집]
   ↓ (문의 알림 이메일)
[브랜드 전용 이메일]
   ↓ (포워딩)
[Email Inbound API]
   ↓
[Raw Email 저장]
   ↓
[AI: 문의 텍스트 추출]
   ↓
[AI: RAG 기반 답변 생성]
   ↓
[Slack Webhook 알림]
```

---

## 3. Step-by-Step 실행 계획

---

### STEP 1. 이메일 수신 인프라 구축

#### 1-1. 수신 방식 선택

아래 중 하나를 선택한다 (초기엔 ① 권장).

1. **SendGrid Inbound Parse (권장)**
2. AWS SES Inbound
3. Resend Inbound

#### 1-2. 브랜드 전용 이메일 구조

```
brand-slug@inbound.your-saas.ai
```

예:
- decozio@inbound.your-saas.ai

셀러는 오늘의집 문의 알림을 해당 주소로 **포워딩**만 하면 된다.

---

### STEP 2. Raw Email 저장

#### 2-1. 서버 API

```
POST /api/inbound/email
```

#### 2-2. 저장 스키마 (예시)

```json
{
  "id": "email_123",
  "brandId": "decozio",
  "from": "noreply@ohouse.co.kr",
  "subject": "[오늘의집] 새로운 문의",
  "rawText": "...",
  "rawHtml": "...",
  "receivedAt": "2025-12-16T10:12:00Z"
}
```

> ⚠️ 이 단계에서는 **절대 파싱하지 않는다**

---

### STEP 3. 고객 문의 텍스트 추출 (AI 활용)

#### 3-1. AI 추출용 System Prompt

```txt
너는 이커머스 고객 문의 알림 이메일을 분석하는 역할이다.
아래 이메일 내용에서 실제 고객이 작성한 질문 문장만 추출하라.

조건:
- 인사말, 자동 안내 문구 제거
- 상품명, 주문번호 제거
- 질문이 여러 개면 모두 반환
- 원문 표현을 최대한 유지

출력은 JSON 배열로 반환한다.
```

#### 3-2. Input 예시

```json
{
  "rawEmail": "..."
}
```

#### 3-3. Output 예시

```json
{
  "questions": [
    "가로 210에 세로 230인데 몇 장 주문해야 하나요?",
    "이음선이 생기나요?"
  ]
}
```

---

### STEP 4. RAG 기반 AI 답변 생성

#### 4-1. 기존 답변 생성 API 재사용

```
POST /api/brands/{brandId}/answer
```

#### 4-2. 처리 순서

1. 질문 1개씩 순차 처리
2. 규칙 엔진 실행
3. File Search 기반 컨텍스트 검색
4. 브랜드 톤 적용
5. 최종 답변 생성

#### 4-3. 결과 데이터 구조

```json
{
  "question": "가로 210에 세로 230인데 몇 장 주문해야 하나요?",
  "answer": "안녕하세요, 맞춤제작 커튼 전문업체 데코지오입니다. 😊 ..."
}
```

---

### STEP 5. Slack 알림 연동 (핵심)

#### 5-1. Slack Incoming Webhook 생성

- 브랜드별 Slack 채널 1개
- Webhook URL을 브랜드 설정에 저장

```json
{
  "brandId": "decozio",
  "slackWebhookUrl": "https://hooks.slack.com/services/..."
}
```

---

#### 5-2. Slack 메시지 포맷 (권장)

```json
{
  "blocks": [
    {
      "type": "header",
      "text": { "type": "plain_text", "text": "📩 새로운 고객 문의 답변 생성" }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*❓ 고객 질문*\n가로 210에 세로 230인데 몇 장 주문해야 하나요?"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*🤖 생성된 AI 답변*\n안녕하세요, 맞춤제작 커튼 전문업체 데코지오입니다. 😊 ..."
      }
    },
    {
      "type": "context",
      "elements": [
        { "type": "mrkdwn", "text": "브랜드: 데코지오 | 출처: 오늘의집 문의 이메일" }
      ]
    }
  ]
}
```

---

### STEP 6. 전체 처리 플로우 요약

1. 오늘의집 문의 발생
2. 문의 알림 이메일 → 브랜드 전용 이메일로 포워딩
3. Email Inbound API 수신
4. Raw Email 저장
5. AI로 질문 문장 추출
6. 질문별 RAG 답변 생성
7. Slack으로 질문+답변 요약 전송

---

## 4. MVP에서 반드시 넣어야 할 안전장치

- Slack 메시지에 **"⚠️ 자동 생성된 초안입니다"** 문구 포함
- 답변 등록은 **사람이 직접** 하도록 유지
- 질문 추출 결과는 서버에 로그로 저장

---

## 5. Slack 알림 고도화 (추가)

### 5-1. Slack 알림을 단순 알림이 아닌 **CS 작업 허브**로 사용

Slack은 단순히 "봤다" 수준의 알림이 아니라,
초기 SaaS 단계에서 **운영·검증·피드백 루프의 중심** 역할을 한다.

#### 기본 원칙

- Slack = 내부 운영 콘솔
- 실제 답변 등록은 여전히 오늘의집에서 사람이 수행
- Slack에서는 **판단과 검증만** 한다

---

### 5-2. Slack 메시지에 포함해야 할 정보 (필수)

- 문의 출처 (오늘의집)
- 브랜드명
- 고객 질문 원문
- AI 생성 답변
- 생성 시각
- ⚠️ 자동 생성 초안 경고 문구

---

### 5-3. Slack Block UI 확장 예시

```json
{
  "blocks": [
    { "type": "header", "text": { "type": "plain_text", "text": "📩 새로운 문의 답변 초안" } },
    { "type": "section", "text": { "type": "mrkdwn", "text": "*브랜드*
데코지오" } },
    { "type": "section", "text": { "type": "mrkdwn", "text": "*❓ 고객 질문*
가로 210에 세로 230인데 몇 장 주문해야 하나요?" } },
    { "type": "section", "text": { "type": "mrkdwn", "text": "*🤖 AI 답변 (초안)*
안녕하세요, 맞춤제작 커튼 전문업체 데코지오입니다. 😊 ..." } },
    { "type": "context", "elements": [ { "type": "mrkdwn", "text": "⚠️ 자동 생성된 초안입니다. 검토 후 사용하세요." } ] }
  ]
}
```

---

### 5-4. Slack 알림의 실질적 가치

- AI 답변 품질을 **팀 단위로 공유** 가능
- 대표/운영자가 모바일에서도 즉시 확인 가능
- 답변이 이상할 경우 즉시 브랜드 문서 수정 → 품질 개선 루프 형성

---

## 6. 확장 포인트 (다음 단계)

- Slack 메시지에 [답변 수정 링크] 버튼 추가
- Chrome Extension과 동일 파이프라인 공유
- 문의 유형 자동 분류 (치수 / 배송 / 교환)

---

## 7. 이 설계의 핵심 철학

- 플랫폼은 건드리지 않는다
- 사람의 판단을 제거하지 않는다
- 자동화는 **"인지 → 준비"** 까지만 담당한다

이 구조는 오늘의집뿐 아니라 **모든 API 없는 플랫폼에 재사용 가능**하다.
